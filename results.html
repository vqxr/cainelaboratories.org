<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<script src="lock.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Results ‚Äî Bloomsbury Burger Therapeutics</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:ital,wght@0,400;0,500;1,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0e0f;
    --surface: #161617;
    --surface2: #1e1e20;
    --border: #2a2a2d;
    --accent: #ff4d6d;
    --accent2: #ff8fa3;
    --green: #52d48a;
    --yellow: #ffd166;
    --blue: #74b3ff;
    --purple: #c77dff;
    --text: #e8e8ea;
    --muted: #888890;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-weight: 300;
    min-height: 100vh;
  }

  /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
  nav {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(14,14,15,0.85);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    height: 56px;
  }

  .nav-left {
    display: flex;
    align-items: center;
    gap: 32px;
  }

  .nav-logo {
    display: flex;
    align-items: center;
    gap: 9px;
    text-decoration: none;
  }

  .nav-logo .emoji { font-size: 18px; }

  .nav-logo .wordmark {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 13px;
    color: var(--accent);
    letter-spacing: -0.01em;
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .nav-links a {
    font-size: 13px;
    color: var(--muted);
    text-decoration: none;
    padding: 6px 12px;
    border-radius: 7px;
    transition: all 0.15s;
    font-weight: 400;
  }

  .nav-links a:hover { color: var(--text); background: var(--surface2); }
  .nav-links a.active { color: var(--text); background: var(--surface2); }

  .nav-right {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--muted);
  }

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  .main {
    max-width: 1100px;
    margin: 0 auto;
    padding: 52px 40px;
  }

  /* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
  .page-header {
    margin-bottom: 40px;
    animation: fadeUp 0.5s ease both;
  }

  .page-header h1 {
    font-family: 'Syne', sans-serif;
    font-size: 36px;
    font-weight: 800;
    letter-spacing: -0.02em;
    margin-bottom: 8px;
  }

  .page-header h1 span { color: var(--accent); }

  .page-header p {
    font-size: 14px;
    color: var(--muted);
    font-style: italic;
  }

  /* ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ */
  .stats-row {
    display: flex;
    gap: 12px;
    margin-bottom: 40px;
    animation: fadeUp 0.5s 0.05s ease both;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px 20px;
    flex: 1;
  }

  .stat-card .label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 6px;
  }

  .stat-card .value {
    font-family: 'Syne', sans-serif;
    font-size: 28px;
    font-weight: 800;
    color: var(--text);
  }

  .stat-card .value.green { color: var(--green); }
  .stat-card .value.yellow { color: var(--yellow); }
  .stat-card .value.accent { color: var(--accent); }

  /* ‚îÄ‚îÄ DROP ZONE ‚îÄ‚îÄ */
  .dropzone-section {
    margin-bottom: 40px;
    animation: fadeUp 0.5s 0.1s ease both;
  }

  .dropzone-label {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 12px;
  }

  .dropzone {
    border: 2px dashed var(--border);
    border-radius: 14px;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--surface);
    position: relative;
  }

  .dropzone:hover, .dropzone.dragover {
    border-color: var(--accent);
    background: rgba(255,77,109,0.04);
  }

  .dropzone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }

  .dropzone .dz-icon { font-size: 32px; margin-bottom: 12px; display: block; }

  .dropzone .dz-title {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 6px;
  }

  .dropzone .dz-sub {
    font-size: 13px;
    color: var(--muted);
  }

  .dropzone .dz-sub span {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--accent2);
  }

  /* ‚îÄ‚îÄ SAMPLE NAME INPUT ‚îÄ‚îÄ */
  .input-row {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
    align-items: center;
  }

  .input-row input, .input-row select {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 14px;
    font-size: 13px;
    font-family: 'DM Mono', monospace;
    color: var(--text);
    outline: none;
    transition: border-color 0.15s;
    flex: 1;
  }

  .input-row input:focus, .input-row select:focus {
    border-color: var(--accent);
  }

  .input-row select option { background: var(--surface2); }

  .btn {
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 9px 18px;
    font-size: 12px;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: opacity 0.15s;
    white-space: nowrap;
  }

  .btn:hover { opacity: 0.85; }
  .btn.secondary {
    background: var(--surface2);
    color: var(--muted);
    border: 1px solid var(--border);
  }
  .btn.secondary:hover { color: var(--text); }

  /* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
  .filter-row {
    display: flex;
    gap: 8px;
    margin-bottom: 28px;
    flex-wrap: wrap;
    animation: fadeUp 0.5s 0.15s ease both;
  }

  .filter-btn {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    padding: 5px 12px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
  }

  .filter-btn:hover, .filter-btn.active {
    border-color: var(--accent);
    color: var(--accent2);
    background: rgba(255,77,109,0.06);
  }

  /* ‚îÄ‚îÄ SAMPLE GRID ‚îÄ‚îÄ */
  .samples-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
    animation: fadeUp 0.5s 0.2s ease both;
  }

  .sample-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: hidden;
    transition: border-color 0.2s, transform 0.2s;
    position: relative;
  }

  .sample-card:hover {
    border-color: rgba(255,77,109,0.35);
    transform: translateY(-2px);
  }

  .sample-card .card-header {
    padding: 14px 16px 12px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    border-bottom: 1px solid var(--border);
  }

  .sample-card .card-name {
    font-family: 'Syne', sans-serif;
    font-size: 15px;
    font-weight: 800;
  }

  .sample-card .card-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
  }

  .tissue-badge {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 5px;
    font-weight: 500;
  }

  .tissue-badge.ectopic { background: rgba(255,77,109,0.12); color: var(--accent2); border: 1px solid rgba(255,77,109,0.2); }
  .tissue-badge.eutopic { background: rgba(82,212,138,0.1); color: var(--green); border: 1px solid rgba(82,212,138,0.2); }
  .tissue-badge.control { background: rgba(116,179,255,0.1); color: var(--blue); border: 1px solid rgba(116,179,255,0.2); }
  .tissue-badge.unknown { background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }

  .status-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    display: inline-block;
  }
  .status-dot.pass { background: var(--green); box-shadow: 0 0 5px var(--green); }
  .status-dot.warn { background: var(--yellow); }
  .status-dot.fail { background: var(--accent); }

  /* QC image */
  .qc-img-wrap {
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 180px;
    overflow: hidden;
    cursor: pointer;
    position: relative;
  }

  .qc-img-wrap img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }

  .qc-img-wrap:hover img { transform: scale(1.03); }

  .qc-img-wrap .no-img {
    font-size: 12px;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    text-align: center;
  }

  .qc-img-wrap .expand-hint {
    position: absolute;
    bottom: 8px; right: 8px;
    background: rgba(0,0,0,0.7);
    color: var(--muted);
    font-size: 10px;
    font-family: 'DM Mono', monospace;
    padding: 3px 7px;
    border-radius: 5px;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .qc-img-wrap:hover .expand-hint { opacity: 1; }

  /* card stats */
  .card-stats {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    border-top: 1px solid var(--border);
  }

  .card-stat {
    padding: 10px 12px;
    border-right: 1px solid var(--border);
  }

  .card-stat:last-child { border-right: none; }

  .card-stat .cs-label {
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-bottom: 3px;
  }

  .card-stat .cs-value {
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    font-weight: 700;
  }

  /* card footer */
  .card-footer {
    padding: 10px 14px;
    display: flex;
    gap: 8px;
    border-top: 1px solid var(--border);
  }

  .file-chip {
    display: flex;
    align-items: center;
    gap: 5px;
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    padding: 4px 9px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--surface2);
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
    flex: 1;
    justify-content: center;
  }

  .file-chip:hover { border-color: var(--accent); color: var(--accent2); }
  .file-chip.has-file { color: var(--green); border-color: rgba(82,212,138,0.25); background: rgba(82,212,138,0.05); }

  /* delete btn */
  .delete-btn {
    position: absolute;
    top: 10px; right: 10px;
    width: 22px; height: 22px;
    background: rgba(255,77,109,0.1);
    border: 1px solid rgba(255,77,109,0.2);
    border-radius: 5px;
    color: var(--accent);
    font-size: 11px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s;
  }

  .sample-card:hover .delete-btn { opacity: 1; }

  /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }

  .empty-state .es-icon { font-size: 40px; margin-bottom: 16px; display: block; }
  .empty-state .es-title {
    font-family: 'Syne', sans-serif;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--text);
  }
  .empty-state p { font-size: 13px; }

  /* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
  .lightbox {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.92);
    z-index: 999;
    align-items: center;
    justify-content: center;
    padding: 40px;
  }

  .lightbox.open { display: flex; }

  .lightbox img {
    max-width: 100%;
    max-height: 90vh;
    border-radius: 10px;
    box-shadow: 0 40px 80px rgba(0,0,0,0.5);
  }

  .lightbox-close {
    position: fixed;
    top: 20px; right: 24px;
    font-size: 28px;
    color: var(--muted);
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    transition: color 0.15s;
  }

  .lightbox-close:hover { color: var(--text); }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideIn {
    from { opacity: 0; transform: scale(0.96) translateY(8px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }

  .sample-card { animation: slideIn 0.3s ease both; }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-left">
    <a href="index.html" class="nav-logo">
      <span class="emoji">üçî</span>
      <span class="wordmark">BBT plc</span>
    </a>
    <div class="nav-links">
      <a href="index.html">Wiki</a>
      <a href="results.html" class="active">Results</a>
    </div>
  </div>
  <div class="nav-right">pre-seed ¬∑ pre-revenue ¬∑ pre-sanity</div>
</nav>

<!-- MAIN -->
<div class="main">

  <!-- HEADER -->
  <div class="page-header">
    <h1>Sample <span>Results</span></h1>
    <p>QC plots and filtered data for each processed sample. Drop files below to add a sample.</p>
  </div>

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="label">Total samples</div>
      <div class="value accent" id="stat-total">0</div>
    </div>
    <div class="stat-card">
      <div class="label">QC passed</div>
      <div class="value green" id="stat-passed">0</div>
    </div>
    <div class="stat-card">
      <div class="label">Ectopic</div>
      <div class="value" style="color:var(--accent2)" id="stat-ectopic">0</div>
    </div>
    <div class="stat-card">
      <div class="label">Eutopic</div>
      <div class="value" style="color:var(--green)" id="stat-eutopic">0</div>
    </div>
    <div class="stat-card">
      <div class="label">Control</div>
      <div class="value" style="color:var(--blue)" id="stat-control">0</div>
    </div>
  </div>

  <!-- DROP ZONE -->
  <div class="dropzone-section">
    <div class="dropzone-label">Add a sample</div>

    <div class="input-row">
      <input type="text" id="sample-name-input" placeholder="Sample name  e.g. sample1" />
      <select id="tissue-select">
        <option value="unknown">Tissue type ‚Äî unknown</option>
        <option value="ectopic">Ectopic lesion</option>
        <option value="eutopic">Eutopic endometrium</option>
        <option value="control">Control tissue</option>
      </select>
      <input type="number" id="cells-input" placeholder="Cells passed QC" style="max-width:180px"/>
      <input type="number" id="genes-input" placeholder="Median genes" style="max-width:160px"/>
    </div>

    <div class="dropzone" id="dropzone">
      <input type="file" id="file-input" multiple accept=".png,.jpg,.jpeg,.h5ad,.h5" />
      <span class="dz-icon">üìÇ</span>
      <div class="dz-title">Drop files here</div>
      <div class="dz-sub">QC plot <span>.png</span> &nbsp;+&nbsp; filtered data <span>.h5ad</span> &nbsp;‚Äî or click to browse</div>
    </div>

    <div class="input-row" style="margin-top:12px;">
      <button class="btn" onclick="addSample()">Add sample</button>
      <button class="btn secondary" onclick="clearAll()">Clear all</button>
    </div>
  </div>

  <!-- FILTERS -->
  <div class="filter-row">
    <div class="filter-btn active" onclick="filter('all', this)">All</div>
    <div class="filter-btn" onclick="filter('ectopic', this)">Ectopic</div>
    <div class="filter-btn" onclick="filter('eutopic', this)">Eutopic</div>
    <div class="filter-btn" onclick="filter('control', this)">Control</div>
    <div class="filter-btn" onclick="filter('unknown', this)">Unknown</div>
  </div>

  <!-- GRID -->
  <div class="samples-grid" id="samples-grid">
    <div class="empty-state">
      <span class="es-icon">üß´</span>
      <div class="es-title">No samples yet</div>
      <p>Drop your QC plot and .h5ad file above to add your first sample.</p>
    </div>
  </div>

</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <span class="lightbox-close">‚úï</span>
  <img id="lightbox-img" src="" alt="QC plot" />
</div>

<script>
  let samples = JSON.parse(localStorage.getItem('bbt-samples') || '[]');
  let currentFilter = 'all';
  let pendingFiles = { img: null, h5ad: null };
  let imgDataURLs = JSON.parse(localStorage.getItem('bbt-imgs') || '{}');

  // ‚îÄ‚îÄ FILE DROP ‚îÄ‚îÄ
  const dz = document.getElementById('dropzone');
  const fi = document.getElementById('file-input');

  dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dragover'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
  dz.addEventListener('drop', e => {
    e.preventDefault();
    dz.classList.remove('dragover');
    handleFiles(e.dataTransfer.files);
  });

  fi.addEventListener('change', () => handleFiles(fi.files));

  function handleFiles(files) {
    Array.from(files).forEach(f => {
      if (f.name.match(/\.(png|jpg|jpeg)$/i)) {
        pendingFiles.img = f;
        dz.querySelector('.dz-title').textContent = '‚úì QC image loaded: ' + f.name;
      } else if (f.name.match(/\.(h5ad|h5)$/i)) {
        pendingFiles.h5ad = f;
      }
    });
    updateDropzoneLabel();
  }

  function updateDropzoneLabel() {
    const parts = [];
    if (pendingFiles.img) parts.push('üìä ' + pendingFiles.img.name);
    if (pendingFiles.h5ad) parts.push('üíæ ' + pendingFiles.h5ad.name);
    if (parts.length) {
      dz.querySelector('.dz-title').textContent = parts.join('   ');
      dz.querySelector('.dz-sub').textContent = 'Ready ‚Äî click "Add sample" below';
    }
  }

  // ‚îÄ‚îÄ ADD SAMPLE ‚îÄ‚îÄ
  function addSample() {
    const name = document.getElementById('sample-name-input').value.trim() || ('sample_' + (samples.length + 1));
    const tissue = document.getElementById('tissue-select').value;
    const cells = document.getElementById('cells-input').value || '‚Äî';
    const genes = document.getElementById('genes-input').value || '‚Äî';

    const sample = {
      id: Date.now(),
      name,
      tissue,
      cells,
      genes,
      hasImg: !!pendingFiles.img,
      hasH5ad: !!pendingFiles.h5ad,
      h5adName: pendingFiles.h5ad?.name || null,
      imgName: pendingFiles.img?.name || null,
      addedAt: new Date().toLocaleDateString('en-GB', { day:'numeric', month:'short' })
    };

    // Store image as data URL
    if (pendingFiles.img) {
      const reader = new FileReader();
      reader.onload = e => {
        imgDataURLs[sample.id] = e.target.result;
        localStorage.setItem('bbt-imgs', JSON.stringify(imgDataURLs));
        renderGrid();
      };
      reader.readAsDataURL(pendingFiles.img);
    }

    samples.push(sample);
    localStorage.setItem('bbt-samples', JSON.stringify(samples));

    // Reset
    pendingFiles = { img: null, h5ad: null };
    document.getElementById('sample-name-input').value = '';
    document.getElementById('cells-input').value = '';
    document.getElementById('genes-input').value = '';
    document.getElementById('tissue-select').value = 'unknown';
    dz.querySelector('.dz-title').textContent = 'Drop files here';
    dz.querySelector('.dz-sub').innerHTML = 'QC plot <span>.png</span> &nbsp;+&nbsp; filtered data <span>.h5ad</span> &nbsp;‚Äî or click to browse';
    fi.value = '';

    renderGrid();
    updateStats();
  }

  // ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ
  function deleteSample(id) {
    samples = samples.filter(s => s.id !== id);
    delete imgDataURLs[id];
    localStorage.setItem('bbt-samples', JSON.stringify(samples));
    localStorage.setItem('bbt-imgs', JSON.stringify(imgDataURLs));
    renderGrid();
    updateStats();
  }

  // ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ
  function filter(type, el) {
    currentFilter = type;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
    renderGrid();
  }

  // ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
  function renderGrid() {
    const grid = document.getElementById('samples-grid');
    const filtered = currentFilter === 'all' ? samples : samples.filter(s => s.tissue === currentFilter);

    if (filtered.length === 0) {
      grid.innerHTML = `
        <div class="empty-state">
          <span class="es-icon">üß´</span>
          <div class="es-title">${samples.length === 0 ? 'No samples yet' : 'No samples match this filter'}</div>
          <p>${samples.length === 0 ? 'Drop your QC plot and .h5ad file above to add your first sample.' : 'Try a different filter.'}</p>
        </div>`;
      return;
    }

    grid.innerHTML = filtered.map(s => {
      const imgSrc = imgDataURLs[s.id];
      const tissueClass = s.tissue;
      const tissueLabel = { ectopic: 'Ectopic', eutopic: 'Eutopic', control: 'Control', unknown: 'Unknown' }[s.tissue];
      const statusDot = s.hasImg ? 'pass' : 'warn';

      return `
        <div class="sample-card">
          <div class="delete-btn" onclick="deleteSample(${s.id})">‚úï</div>
          <div class="card-header">
            <div>
              <div class="card-name">${s.name}</div>
              <div style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:3px;">${s.addedAt}</div>
            </div>
            <div class="card-meta">
              <span class="tissue-badge ${tissueClass}">${tissueLabel}</span>
              <span style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;display:flex;align-items:center;gap:4px;">
                <span class="status-dot ${statusDot}"></span> QC ${s.hasImg ? 'done' : 'pending'}
              </span>
            </div>
          </div>

          <div class="qc-img-wrap" onclick="${imgSrc ? 'openLightbox("' + s.id + '")' : ''}">
            ${imgSrc
              ? `<img src="${imgSrc}" alt="QC plot for ${s.name}" /><span class="expand-hint">click to expand</span>`
              : `<div class="no-img">No QC plot uploaded</div>`
            }
          </div>

          <div class="card-stats">
            <div class="card-stat">
              <div class="cs-label">Cells</div>
              <div class="cs-value">${Number(s.cells).toLocaleString() || s.cells}</div>
            </div>
            <div class="card-stat">
              <div class="cs-label">Med. genes</div>
              <div class="cs-value">${Number(s.genes).toLocaleString() || s.genes}</div>
            </div>
            <div class="card-stat">
              <div class="cs-label">Files</div>
              <div class="cs-value" style="font-size:18px;">${(s.hasImg ? 'üìä' : '') + (s.hasH5ad ? 'üíæ' : '')}</div>
            </div>
          </div>

          <div class="card-footer">
            <div class="file-chip ${s.hasImg ? 'has-file' : ''}">
              ${s.hasImg ? '‚úì ' + s.imgName : 'No QC image'}
            </div>
            <div class="file-chip ${s.hasH5ad ? 'has-file' : ''}">
              ${s.hasH5ad ? '‚úì ' + s.h5adName : 'No .h5ad'}
            </div>
          </div>
        </div>`;
    }).join('');

    updateStats();
  }

  // ‚îÄ‚îÄ STATS ‚îÄ‚îÄ
  function updateStats() {
    document.getElementById('stat-total').textContent = samples.length;
    document.getElementById('stat-passed').textContent = samples.filter(s => s.hasImg).length;
    document.getElementById('stat-ectopic').textContent = samples.filter(s => s.tissue === 'ectopic').length;
    document.getElementById('stat-eutopic').textContent = samples.filter(s => s.tissue === 'eutopic').length;
    document.getElementById('stat-control').textContent = samples.filter(s => s.tissue === 'control').length;
  }

  // ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ
  function openLightbox(id) {
    document.getElementById('lightbox-img').src = imgDataURLs[id];
    document.getElementById('lightbox').classList.add('open');
  }

  function closeLightbox() {
    document.getElementById('lightbox').classList.remove('open');
  }

  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

  // ‚îÄ‚îÄ CLEAR ALL ‚îÄ‚îÄ
  function clearAll() {
    if (!confirm('Clear all samples?')) return;
    samples = [];
    imgDataURLs = {};
    localStorage.setItem('bbt-samples', '[]');
    localStorage.setItem('bbt-imgs', '{}');
    renderGrid();
    updateStats();
  }

  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
  renderGrid();
  updateStats();
</script>
</body>
</html>
